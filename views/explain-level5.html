<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Explication ‚Äì Level 5 (IDOR)</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>

    <div
      class="matrix-content"
      style="align-items:flex-start; text-align:left; max-width:800px;"
    >
      <h1>Level 5 ‚Äì IDOR (Insecure Direct Object Reference)</h1>
      <p class="subtitle">
        Ce niveau montre une vuln√©rabilit√© tr√®s fr√©quente : on expose un
        identifiant dans l'URL sans v√©rifier que l'utilisateur a le droit de
        voir la ressource.
      </p>

      <h2>‚ö†Ô∏è Ce qui √©tait vuln√©rable</h2>
      <p>Le code c√¥t√© serveur faisait :</p>

      <pre
        style="white-space:pre-wrap; background:rgba(15,23,42,0.9); padding:12px; border-radius:8px;"
      >const currentUserId = req.session.userId;
const requestedId = req.query.id ? parseInt(req.query.id, 10) : currentUserId;

const [rows] = await db.execute(
  "SELECT id, username FROM users WHERE id = ?",
  [requestedId]
);</pre>

      <p>
        Le serveur r√©cup√®re directement l'utilisateur correspondant √†
        <code>id</code> dans l'URL, sans v√©rifier que cet id correspond bien √†
        l'utilisateur connect√©.
      </p>

      <h2>üîç Comment tu as exploit√© la vuln√©rabilit√©</h2>
      <ul>
        <li>Tu t'es connect√© avec ton compte.</li>
        <li>Tu as ouvert <code>/profile-vuln</code>.</li>
        <li>
          Tu as ensuite modifi√© l'URL en
          <code>/profile-vuln?id=1</code>, <code>?id=2</code>, etc.
        </li>
        <li>
          Quand l'id ne correspondait plus √† ton id de session, tu as pu voir le
          profil de quelqu'un d'autre ‚Üí et obtenir le flag.
        </li>
      </ul>

      <h2>‚úÖ Ce qu'il faudrait faire en vrai</h2>
      <ul>
        <li>
          Ne pas faire confiance √† un id pass√© en clair sans le v√©rifier c√¥t√©
          serveur.
        </li>
        <li>
          Toujours v√©rifier que la ressource appartient bien √† l'utilisateur
          connect√© :<br />
          ex. <code>WHERE id = ? AND id = userIdDeSession</code>, ou v√©rifier
          que l'utilisateur a le droit d'acc√®s.
        </li>
        <li>
          Dans certains cas, utiliser des identifiants non pr√©dictibles
          (UUID, tokens).
        </li>
      </ul>

      <p style="margin-top:20px;">
        <a href="/game" class="btn btn-secondary">üè† Retour au hub</a>
      </p>
    </div>

    
  </body>
</html>