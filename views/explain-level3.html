<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Explication ‚Äì Level 3 (XSS Stock√©e)</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>

    <div
      class="matrix-content"
      style="align-items:flex-start; text-align:left; max-width:800px;"
    >
      <h1>Level 3 ‚Äì XSS (Stock√©)</h1>
      <p class="subtitle">
        Ici, la XSS n'est pas seulement refl√©t√©e : elle est stock√©e en base, et
        rejou√©e √† chaque chargement de la page.
      </p>

      <h2>‚ö†Ô∏è Ce qui √©tait vuln√©rable</h2>
      <p>C√¥t√© serveur, les commentaires √©taient ins√©r√©s tel quel :</p>

      <pre
        style="white-space:pre-wrap; background:rgba(15,23,42,0.9); padding:12px; border-radius:8px;"
      >await db.execute(
  "INSERT INTO comments (user_id, content) VALUES (?, ?)",
  [userId, content]
);</pre>

      <p>Puis r√©-affich√©s sans √©chappement :</p>
      <pre
        style="white-space:pre-wrap; background:rgba(15,23,42,0.9); padding:12px; border-radius:8px;"
      >${row.content}</pre>

      <p>
        Donc si quelqu'un poste un commentaire contenant une balise
        <code>&lt;script&gt;</code>, ce script sera ex√©cut√© pour
        <strong>tous</strong> les utilisateurs qui visitent la page.
      </p>

      <h2>üîç Comment tu as exploit√© la vuln√©rabilit√©</h2>
      <ul>
        <li>Tu as √©crit un commentaire ‚Äúnormal‚Äù pour voir le comportement.</li>
        <li>
          Puis tu as post√© un payload du type :
          <code>&lt;script&gt;...&lt;/script&gt;</code>.
        </li>
        <li>
          Ton script s'ex√©cutait √† chaque fois que tu revenais sur
          <code>/comments-vuln</code>.
        </li>
        <li>
          Le flag √©tait cach√© dans un attribut
          <code>data-flag</code> :
        </li>
      </ul>

      <pre
        style="white-space:pre-wrap; background:rgba(15,23,42,0.9); padding:12px; border-radius:8px;"
      >&lt;div id="secret-flag" data-flag="FLAG{...}" style="display:none;"&gt;&lt;/div&gt;</pre>

      <p>
        Tu as pu le lire depuis ton script avec :
        <code>document.getElementById('secret-flag').dataset.flag</code>.
      </p>

      <h2>‚úÖ Ce qu'il faudrait faire en vrai</h2>
      <ul>
        <li>√âchapper toute sortie utilisateur affich√©e dans le HTML.</li>
        <li>Sanitiser les donn√©es au moment de l'affichage.</li>
        <li>
          Dans certains cas, filtrer totalement certaines balises
          (<code>&lt;script&gt;</code>, <code>on*</code>, etc.).
        </li>
      </ul>

      <p style="margin-top:20px;">
        <a href="/game" class="btn btn-secondary">üè† Retour au hub</a>
      </p>
    </div>

  </body>
</html>