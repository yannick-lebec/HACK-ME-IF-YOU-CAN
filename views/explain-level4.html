<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Explication â€“ Level 4 (Broken Access Control)</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>

    <div
      class="matrix-content"
      style="align-items:flex-start; text-align:left; max-width:800px;"
    >
      <h1>Level 4 â€“ Broken Access Control</h1>
      <p class="subtitle">
        Ici, le problÃ¨me n'est pas une injection, mais un <strong>contrÃ´le
        d'accÃ¨s mal pensÃ©</strong>.
      </p>

      <h2>âš ï¸ Ce qui Ã©tait vulnÃ©rable</h2>
      <p>Dans le code de <code>/admin-panel</code>, il y avait deux checks :</p>

      <pre
        style="white-space:pre-wrap; background:rgba(15,23,42,0.9); padding:12px; border-radius:8px;"
      >const isAdminSession = username === "admin";
const isAdminDebug = req.query.asAdmin === "1";</pre>

      <p>
        Ensuite, l'accÃ¨s Ã©tait accordÃ© si <code>isAdminSession</code> ou
        <code>isAdminDebug</code> Ã©tait vrai :
      </p>

      <pre
        style="white-space:pre-wrap; background:rgba(15,23,42,0.9); padding:12px; border-radius:8px;"
      >if (!isAdminSession && !isAdminDebug) {
  // AccÃ¨s refusÃ©
} else {
  // AccÃ¨s admin
}</pre>

      <p>
        Le paramÃ¨tre <code>asAdmin=1</code> permettait Ã  n'importe qui de contourner
        le contrÃ´le d'accÃ¨sâ€¦
      </p>

      <h2>ğŸ” Comment tu as exploitÃ© la vulnÃ©rabilitÃ©</h2>
      <ul>
        <li>Tu as essayÃ© d'accÃ©der Ã  <code>/admin-panel</code> sans Ãªtre admin.</li>
        <li>Tu as vu un message d'accÃ¨s refusÃ©.</li>
        <li>
          Tu as testÃ© un paramÃ¨tre comme :
          <code>/admin-panel?asAdmin=1</code>.
        </li>
        <li>
          Le serveur t'a alors donnÃ© accÃ¨s Ã  la â€œzone adminâ€ et au flag, sans
          vÃ©rifier ton vrai rÃ´le.
        </li>
      </ul>

      <h2>âœ… Ce qu'il faudrait faire en vrai</h2>
      <ul>
        <li>Ne <strong>jamais</strong> se baser sur un paramÃ¨tre contrÃ´lÃ© par le client pour un rÃ´le.</li>
        <li>Stocker les droits dans la session ou un token cÃ´tÃ© serveur.</li>
        <li>Centraliser la logique d'autorisation (middleware, policy, etc.).</li>
        <li>Ã‰viter les â€œbackdoors de debugâ€ en prod.</li>
      </ul>

      <p style="margin-top:20px;">
        <a href="/game" class="btn btn-secondary">ğŸ  Retour au hub</a>
      </p>
    </div>

    
  </body>
</html>